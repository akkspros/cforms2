<?php
/* 
 * Plugin Name: cforms2-my-functions
 * Description: Find below examples for your custom routines. Do not change the function names.
 * The old way of extending cformsII is deprecated.
 * The preferred way of doing it is via WordPress actions and filters.
 * You find their 'cforms2_' prefixed names at the apply_filters and do_action calls.
 * For some of these new actions and filters examples are given below.
 */

### DEPRECATED
###
### my_cforms_filter() : in case you'd like to manipulate / check user input after standard validation,
###                      but before special validations, like captchas.
###
### my_cforms_filter() : after validation, before processing/saving input data
###
### my_cforms_action() : compatible to new cforms2_after_processing_action
###

### TO USE THE FUNCTIONS:
###  1) copy this file to your plugin directory
###  2) rename it ending with extension *.php
###  3) remove the functions you do not need and customize the needed ones
###  4) activate this plugin



###
### Your custom user data input filter
### @deprecated
###
function my_cforms_filter($formIDOrPostData) {

    global $track;

    ###       $track stores all user input
    ### Note: $formID = '' (empty) for the first form!

    ### triggers on your third form
    if ( $formIDOrPostData == '3' ) {

        ### Do something with the data or not, up to you
        $track['Your Name'] = 'Mr./Mrs. '.$track['Your Name'];

        ### Send to 3d party or do something else
        wp_mail('you@example.com', 'cforms my_filter test', print_r($track,1), 'From: you@example.com');
    }

    ### triggers on your third form before any cforms processing
    elseif ( isset($formIDOrPostData['sendbutton3']) ) {

            ### do something with field name 'cf3_field_3'
            ### (! check you HTML source to properly reference your form fields !)
            $formIDOrPostData['cf3_field_3'] = 'Mr./Mrs. '.$formIDOrPostData['cf3_field_3'];

            ### perhaps send an email or do something different
            wp_mail('you@example.com', 'cforms my_filter_nonAjax test', 'Form data array (nonAjax):'.print_r($formIDOrPostData, 1), 'From: you@example.com');
    }

}


/**
 * Your custom user data action routine
 * gets triggered just before sending the admin email
 */
add_action('cforms2_after_processing_action', function ($cformsdata) {

    // Extract Data
    // Note: $cformsdata['id'] = '' (empty) for the first form!

    $formID = $cformsdata['id'];
    $form   = $cformsdata['data'];

    // triggers on your third form
    if ( $formID == '3' ) {

        // Do something with the data or not, up to you
        $form['Your Name'] = 'Mr./Mrs. '.$form['Your Name'];

    }

    // Send to 3d party or do something else.
    // You can throw an Exception. Its message is printed on the screen.
    if (!wp_mail('you@example.com', 'cforms my_action test', print_r($form,1), 'From: you@example.com'))
        throw new Exception('Mail could not be sent');

});
